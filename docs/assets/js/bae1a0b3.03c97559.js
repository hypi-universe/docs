"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7412],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),d=i,m=u["".concat(l,".").concat(d)]||u[d]||h[d]||o;return n?a.createElement(m,r(r({ref:t},c),{},{components:n})):a.createElement(m,r({ref:t},c))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8196:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],s={id:"openwhisk-annotations",title:"Annotations",sidebar_label:"Annotations",slug:"/lowcode/openwhisk-annotations"},l=void 0,p={unversionedId:"lowcode/openwhisk-annotations",id:"lowcode/openwhisk-annotations",title:"Annotations",description:"OpenWhisk actions, triggers, rules and packages (collectively referred to as assets) may be decorated with annotations. Annotations are attached to assets just like parameters with a key that defines a name and value that defines the value. It is convenient to set them from the command line interface (CLI) via --annotation or -a for short.",source:"@site/content/lowcode/openwhisk-annotations.md",sourceDirName:"lowcode",slug:"/lowcode/openwhisk-annotations",permalink:"/docs/lowcode/openwhisk-annotations",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/lowcode/openwhisk-annotations.md",tags:[],version:"current",frontMatter:{id:"openwhisk-annotations",title:"Annotations",sidebar_label:"Annotations",slug:"/lowcode/openwhisk-annotations"},sidebar:"docs",previous:{title:"Parameters",permalink:"/docs/lowcode/openwhisk-parameters"},next:{title:"Triggers and Rules",permalink:"/docs/lowcode/openwhisk-triggers"}},c=[{value:"Annotations for all actions",id:"annotations-for-all-actions",children:[],level:3},{value:"Annotations specific to web actions",id:"annotations-specific-to-web-actions",children:[],level:3},{value:"Annotations specific to activations",id:"annotations-specific-to-activations",children:[],level:3}],h={toc:c};function u(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"OpenWhisk actions, triggers, rules and packages (collectively referred to as assets) may be decorated with ",(0,o.kt)("inlineCode",{parentName:"p"},"annotations"),". Annotations are attached to assets just like parameters with a ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," that defines a name and ",(0,o.kt)("inlineCode",{parentName:"p"},"value")," that defines the value. It is convenient to set them from the command line interface (CLI) via ",(0,o.kt)("inlineCode",{parentName:"p"},"--annotation")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"-a")," for short."),(0,o.kt)("p",null,"Rationale: Annotations were added to OpenWhisk to allow for experimentation without making changes to the underlying asset schema. We had, until the writing of this document, deliberately not defined what ",(0,o.kt)("inlineCode",{parentName:"p"},"annotations")," are permitted. However as we start to use annotations more heavily to impart semantic changes, it's important that we finally start to document them."),(0,o.kt)("p",null,'The most prevalent use of annotations to date is to document actions and packages. You\'ll see many of the packages in the OpenWhisk catalog carry annotations such as a description of the functionality offered by their actions, which parameters are required at package binding time, and which are invoke-time parameters, whether a parameter is a "secret" (e.g., password), or not. We have invented these as needed, for example to allow for UI integration.'),(0,o.kt)("p",null,"Here is a sample set of annotations for an ",(0,o.kt)("inlineCode",{parentName:"p"},"echo")," action which returns its input arguments unmodified (e.g., ",(0,o.kt)("inlineCode",{parentName:"p"},"function main(args) { return args }"),"). This action may be useful for logging input parameters for example as part of a sequence or rule."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'hypi wsk action create echo echo.js \\\n    -a description \'An action which returns its input. Useful for logging input to enable debug/replay.\' \\\n    -a parameters  \'[{ "required":false, "description": "Any JSON entity" }]\'\\\n    -a sampleInput  \'{ "msg": "Five fuzzy felines"}\' \\\n    -a sampleOutput \'{ "msg": "Five fuzzy felines"}\'\n')),(0,o.kt)("p",null,"The annotations we have used for describing packages are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"description"),": a pithy description of the package"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"parameters"),": an array describing parameters that are scoped to the package (described further below)")),(0,o.kt)("p",null,"Similarly, for actions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"description"),": a pithy description of the action"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"parameters"),": an array describing actions that are required to execute the action"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"sampleInput"),": an example showing the input schema with typical values"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"sampleOutput"),": an example showing the output schema, usually for the ",(0,o.kt)("inlineCode",{parentName:"li"},"sampleInput"))),(0,o.kt)("p",null,"The annotations we have used for describing parameters include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name"),": the name of the parameter"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"description"),": a pithy description of the parameter"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"doclink"),": a link to further documentation for parameter (useful for OAuth tokens for example)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"required"),": true for required parameters and false for optional ones"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"bindTime"),": true if the parameter should be specified when a package is bound"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"type"),": the type of the parameter, one of ",(0,o.kt)("inlineCode",{parentName:"li"},"password"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"array")," (but may be used more broadly)")),(0,o.kt)("p",null,"The annotations are ",(0,o.kt)("em",{parentName:"p"},"not")," checked. So while it is conceivable to use the annotations to infer if a composition of two actions into a sequence is legal, for example, the system does not yet do that."),(0,o.kt)("h3",{id:"annotations-for-all-actions"},"Annotations for all actions"),(0,o.kt)("p",null,"The following annotations on an action are available."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"provide-api-key"),": This annotation may be attached to actions which require an API key, for example to make REST API calls to the OpenWhisk host. For newly created actions, if not specified, it defaults to a false value. For existing actions, the absence of this annotation, or its presence with a value that is not ",(0,o.kt)("em",{parentName:"li"},"falsy")," (i.e., a value that is different from zero, null, false, and the empty string) will cause an API key to be present in the action execution context.")),(0,o.kt)("h3",{id:"annotations-specific-to-web-actions"},"Annotations specific to web actions"),(0,o.kt)("p",null,"Web actions are enabled with explicit annotations which decorate individual actions. The annotations only apply to the ",(0,o.kt)("a",{parentName:"p",href:"/docs/lowcode/openwhisk-webactions"},"web actions")," API, and must be present and explicitly set to ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," to have an affect. The annotations have no meaning otherwise in the system. The annotations are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"web-export"),": Makes its corresponding action accessible to REST calls ",(0,o.kt)("em",{parentName:"li"},"without")," authentication. We call these ",(0,o.kt)("a",{parentName:"li",href:"/docs/lowcode/openwhisk-webactions"},(0,o.kt)("em",{parentName:"a"},"web actions"))," because they allow one to use OpenWhisk actions from a browser for example. It is important to note that the ",(0,o.kt)("em",{parentName:"li"},"owner")," of the web action incurs the cost of running them in the system (i.e., the ",(0,o.kt)("em",{parentName:"li"},"owner")," of the action also owns the activations record). The rest of the annotations described below have no effect on the action unless this annotation is also set."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"final"),": Makes all of the action parameters that are already defined immutable. A parameter of an action carrying the annotation may not be overridden by invoke-time parameters once the parameter has a value defined through its enclosing package or the action definition."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"raw-http"),": When set, the HTTP request query and body parameters are passed to the action as reserved properties."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"web-custom-options"),": When set, this annotation enables a web action to respond to OPTIONS requests with customized headers, otherwise a ",(0,o.kt)("a",{parentName:"li",href:"/docs/lowcode/openwhisk-webactions#options-requests"},"default CORS response")," applies."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"require-whisk-auth"),": This annotation protects the web action so that it is only invoked by requests that provide appropriate authentication credentials. When set to a boolean value, it controls whether or not the request's Basic Authentication value (i.e. Whisk auth key) will be authenticated - a value of ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," will authenticate the credentials, a value of ",(0,o.kt)("inlineCode",{parentName:"li"},"false")," will invoke the action without any authentication. When set to a number or a string, this value must match the request's ",(0,o.kt)("inlineCode",{parentName:"li"},"X-Require-Whisk-Auth")," header value. In both cases, it is important to note that the ",(0,o.kt)("em",{parentName:"li"},"owner")," of the web action will still incur the cost of running them in the system (i.e., the ",(0,o.kt)("em",{parentName:"li"},"owner")," of the action also owns the activations record).")),(0,o.kt)("h3",{id:"annotations-specific-to-activations"},"Annotations specific to activations"),(0,o.kt)("p",null,"The system decorates activation records with annotations as well. They are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"path"),": the fully qualified path name of the action that generated the activation. Note that if this activation was the result of an action in a package binding, the path refers to the parent package."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"binding"),": the entity path of the package binding. Note that this is only present for actions in a package binding."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"kind"),": the kind of action executed, and one of the support OpenWhisk runtime kinds."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"limits"),": the time, memory and log limits that this activation were subject to.")),(0,o.kt)("p",null,"Additionally for sequence related activations, the system will generate the following annotations:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"topmost"),": this is only present for an outermost sequence action."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"causedBy"),": this is only present for actions that are contained in a sequence.")),(0,o.kt)("p",null,"Lastly, and in order to provide you with some performance transparency, activations also record:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"waitTime"),": the time spent waiting in the internal OpenWhisk system. This is roughly the time spent between the controller receiving the activation request and when the invoker provisioned a container for the action."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"initTime"),": the time spent initializing the function. If this value is present, the action required initialization and represents a cold start. A warm activation will skip initialization, and in this case, the annotation is not generated.")),(0,o.kt)("p",null,"An example of these annotations as they would appear in an activation record is shown below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'"annotations": [\n  {\n    "key": "path",\n    "value": "guest/echo"\n  },\n  {\n    "key": "waitTime",\n    "value": 66\n  },\n  {\n    "key": "kind",\n    "value": "nodejs:6"\n  },\n  {\n    "key": "initTime",\n    "value": 50\n  },\n  {\n    "key": "limits",\n    "value": {\n      "logs": 10,\n      "memory": 256,\n      "timeout": 60000\n    }\n  }\n]\n')),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Large portions of this page is copied from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/openwhisk/tree/master/docs"},"Apache OpenWhisk documentation")," on April 23rd 2021 - where there have been customisations to match Hypi's deployment this has been noted. Apache OpenWhisk and the Apache name are the property of the Apache Foundation and licensed under the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/openwhisk/blob/master/LICENSE.txt"},"Apache V2 license")," ."))))}u.isMDXComponent=!0}}]);