"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4793],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(k,i(i({ref:t},p),{},{components:n})):r.createElement(k,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6300:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],l={id:"create-serverless",title:"Create Serverless Function",sidebar_label:"Create Serverless Function",slug:"/lowcode/create-serverless"},s=void 0,c={unversionedId:"lowcode/create-serverless",id:"lowcode/create-serverless",title:"Create Serverless Function",description:"OpenWhisk requires a JSON object as output. Hence, serverless function cannot return arrays. It must return an object at the top level which can have arrays inside it.",source:"@site/content/lowcode/create-serverless.md",sourceDirName:"lowcode",slug:"/lowcode/create-serverless",permalink:"/docs/lowcode/create-serverless",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/lowcode/create-serverless.md",tags:[],version:"current",frontMatter:{id:"create-serverless",title:"Create Serverless Function",sidebar_label:"Create Serverless Function",slug:"/lowcode/create-serverless"},sidebar:"docs",previous:{title:"OpenWhisk CLI",permalink:"/docs/lowcode/openwhisk-cli"},next:{title:"Use Serverless Function",permalink:"/docs/lowcode/use-serverless"}},p=[{value:"args. hypi object",id:"args-hypi-object",children:[],level:3},{value:"Serverless Function Example",id:"serverless-function-example",children:[],level:3}],u={toc:p};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"OpenWhisk requires a JSON object as output. Hence, serverless function cannot return arrays. It must return an object at the top level which can have arrays inside it."))),(0,o.kt)("p",null,"The creation of serverless function is effortless! "),(0,o.kt)("p",null,"After installation of CLI, ",(0,o.kt)("a",{parentName:"p",href:"/docs/lowcode/openwhisk-cli"},"configure")," ",(0,o.kt)("inlineCode",{parentName:"p"},"OpenWhisk")," to point towards Hypi's endpoint. Once it gets configured, you are ready to create a Serverless function."),(0,o.kt)("h3",{id:"args-hypi-object"},"args. hypi object"),(0,o.kt)("p",null,"Every serverless function has access to ",(0,o.kt)("inlineCode",{parentName:"p"},"args.hypi")," object. You can use this object to connect to ",(0,o.kt)("a",{parentName:"p",href:"/docs/lowcode/api-references"},"Hypi APIs"),"."),(0,o.kt)("p",null,"  ",(0,o.kt)("inlineCode",{parentName:"p"},"args.hypi")," object contains the following fields:  "),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"token"),(0,o.kt)("td",{parentName:"tr",align:null},"The token used to ",(0,o.kt)("a",{parentName:"td",href:"/docs/lowcode/openwhisk-cli#configure-openwhisk"},"configure the serverless function"),". It can be null for anonymous requests.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"instanceId"),(0,o.kt)("td",{parentName:"tr",align:null},"The ",(0,o.kt)("a",{parentName:"td",href:"/docs/lowcode/overview#instance"},"instance")," ID that the serverless function is executed in.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"accountId"),(0,o.kt)("td",{parentName:"tr",align:null},"The ",(0,o.kt)("a",{parentName:"td",href:"/docs/lowcode/core#account"},"account")," ID of the user making the API request.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"domain"),(0,o.kt)("td",{parentName:"tr",align:null},"The domain of the instance the request is made to.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"env"),(0,o.kt)("td",{parentName:"tr",align:null},"A map of any environment variables the user has created and set in the instance.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"adminToken"),(0,o.kt)("td",{parentName:"tr",align:null},"An admin token that can be used to perform actions on behalf of users other than the one making the request. This can be used, for example, to create permissions or link data on behalf of other users who wouldn't have permission to do so.")))),(0,o.kt)("h3",{id:"serverless-function-example"},"Serverless Function Example"),(0,o.kt)("p",null,"We will be using ",(0,o.kt)("inlineCode",{parentName:"p"},"Javascript")," with NodeJS runtime to write our serverless function. And then we will create its docker image on Openwhisk and invoke it to use with the Hypi platform."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Let's follow the below steps to create ",(0,o.kt)("inlineCode",{parentName:"p"},"Serverless Function")," ")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create Java Script file action.js in a folder. Write  'Hello World' function in it.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function main(args) {\n    console.log('Hello World');\n    // throw new Error('It failed!');\n    return { hello: 'world', args: args };\n}\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Create an action called ",(0,o.kt)("inlineCode",{parentName:"li"},"hithere")," using action.js. ")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk action create hithere action.js\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ok: created action\n")),(0,o.kt)("p",null,"The docker image of the javascript function 'Hello World' gets created by OpenWhisk. ",(0,o.kt)("inlineCode",{parentName:"p"},"hithere")," gets listed on a namespace on the Hypi platform."),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Invoke an action ",(0,o.kt)("inlineCode",{parentName:"li"},"hithere"),".  This is an activation of the serverless function. Now, your action is ready to use on Hypi platform as serverless function.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk action invoke hithere --param x 1 --param y hi --result\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "args": {\n        "x": 1,\n        "y": "hi"\n    },\n    "hello": "world"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"--param")," takes input parameters for the function. ",(0,o.kt)("inlineCode",{parentName:"p"},"--result")," shows the result of the function."),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"If you invoke the function without ",(0,o.kt)("inlineCode",{parentName:"li"},"--result")," parameter, you will get the activation ",(0,o.kt)("inlineCode",{parentName:"li"},"id")," of the action ",(0,o.kt)("inlineCode",{parentName:"li"},"hithere"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk action invoke hithere --param x 1 --param y hi\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ok: invoked /_/hithere with id ee11ee981b984c1b91ee981b98cc1b48\n")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"You may get activation details of the action using the ",(0,o.kt)("inlineCode",{parentName:"li"},"id")," received in the previous step.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk activation get ee11ee981b984c1b91ee981b98cc1b48\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "namespace": "01F2GA50PHFK7BAE9FZTPSPBK3",\n    "name": "hithere",\n    "version": "0.0.1",\n    "subject": "01F2GA50PHFK7BAE9FZTPSPBK3",\n    "activationId": "ee11ee981b984c1b91ee981b98cc1b48",\n    "start": 1619068249600,\n    "end": 1619068249603,\n    "duration": 3,\n    "statusCode": 0,\n    "response": {\n        "status": "success",\n        "statusCode": 0,\n        "success": true,\n        "result": {\n            "args": {\n                "x": 1,\n                "y": "hi"\n            },\n            "hello": "world"\n        }\n    },\n    "logs": [\n        "2021-04-22T05:10:49.60266801Z  stdout: Hello World"\n    ],\n    "annotations": [\n        {\n            "key": "path",\n            "value": "01F2GA50PHFK7BAE9FZTPSPBK3/hithere"\n        },\n        {\n            "key": "waitTime",\n            "value": 90\n        },\n        {\n            "key": "kind",\n            "value": "nodejs:10"\n        },\n        {\n            "key": "timeout",\n            "value": false\n        },\n        {\n            "key": "limits",\n            "value": {\n                "concurrency": 1,\n                "logs": 10,\n                "memory": 256,\n                "timeout": 60000\n            }\n        }\n    ],\n    "publish": false\n}\n')),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"You may retrieve the action list and namespace list with the following commands.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk action list\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"actions\n/01F2GA50PHFK7BAE9FZTPSPBK3/hithere                                    private nodejs:10\n/01F2GA50PHFK7BAE9FZTPSPBK3/serverlessFun                              private nodejs:10\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk namespace list\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"namespaces\n01F2GA50PHFK7BAE9FZTPSPBK3\n")),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"Verify that the action was invoked by checking the activations list:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk activation list\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Datetime Activation ID     Kind      Start Duration   Status  Entity\n2021-04-19 18:57:33 6955a0e828af40a195a0e828afe0a128 nodejs:10 cold  40ms       success 01F2GA50PH...TPSPBK3/hithere:0.0.1\n2021-04-19 16:34:31 26285233eaba4960a85233eaba4960aa nodejs:10 cold  36ms       success 01F2GA50PH...TPSPBK3/serverlessFun:0.0.1\n")))}d.isMDXComponent=!0}}]);