(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6853],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return h}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),h=a,f=u["".concat(s,".").concat(h)]||u[h]||d[h]||o;return n?i.createElement(f,r(r({ref:t},p),{},{components:n})):i.createElement(f,r({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7287:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return u}});var i=n(2122),a=n(9756),o=(n(7294),n(3905)),r=["components"],l={id:"actions-swift",title:"Swift actions",sidebar_label:"Swift actions",slug:"/actions-swift"},s=void 0,c={unversionedId:"actions-swift",id:"actions-swift",isDocsHomePage:!1,title:"Swift actions",description:"OpenWhisk requires a JSON object as output. Hence, serverless function cannot return arrays. It must return an object at the top level which can have arrays inside it.",source:"@site/content/actions-swift.md",sourceDirName:".",slug:"/actions-swift",permalink:"/docs/actions-swift",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/actions-swift.md",version:"current",frontMatter:{id:"actions-swift",title:"Swift actions",sidebar_label:"Swift actions",slug:"/actions-swift"},sidebar:"docs",previous:{title:"Java actions",permalink:"/docs/actions-java"},next:{title:"Go actions",permalink:"/docs/actions-go"}},p=[{value:"Packaging an action as a Swift executable",id:"packaging-an-action-as-a-swift-executable",children:[]},{value:"Compiling Swift 4.2 packaged actions",id:"compiling-swift-42-packaged-actions",children:[]},{value:"Error Handling in Swift 4",id:"error-handling-in-swift-4",children:[]},{value:"Reference",id:"reference",children:[]}],d={toc:p};function u(e){var t=e.components,n=(0,a.Z)(e,r);return(0,o.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"OpenWhisk requires a JSON object as output. Hence, serverless function cannot return arrays. It must return an object at the top level which can have arrays inside it."))),(0,o.kt)("p",null,"The process of creating Swift actions is similar to that of ",(0,o.kt)("a",{parentName:"p",href:"/docs/openwhisk-actions#the-basics"},"other actions"),".\nThe following sections guide you through creating and invoking a single Swift action,\nand demonstrate how to bundle multiple Swift files and third party dependencies."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Tip:")," You can use the ",(0,o.kt)("a",{parentName:"p",href:"http://online.swiftplayground.run"},"Online Swift Playground")," to test your Swift code without having to install Xcode on your machine."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:")," Swift actions run in a Linux environment. Swift on Linux is still in development,\nand OpenWhisk usually uses the latest available release, which is not necessarily stable.\nIn addition, the version of Swift that is used with OpenWhisk might be inconsistent with versions\nof Swift from stable releases of Xcode on MacOS."),(0,o.kt)("h4",{id:"swift-4"},"Swift 4"),(0,o.kt)("p",null,"An action is simply a top-level Swift function. For example, create a file called\n",(0,o.kt)("inlineCode",{parentName:"p"},"hello.swift")," with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'func main(args: [String:Any]) -> [String:Any] {\n    if let name = args["name"] as? String {\n        return [ "greeting" : "Hello \\(name)!" ]\n    } else {\n        return [ "greeting" : "Hello stranger!" ]\n    }\n}\n')),(0,o.kt)("p",null,"In this example the Swift action consumes a dictionary and produces a dictionary."),(0,o.kt)("p",null,"You can create an OpenWhisk action called ",(0,o.kt)("inlineCode",{parentName:"p"},"helloSwift")," from this function as\nfollows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk action create helloSwift hello.swift\n")),(0,o.kt)("h4",{id:"swift-4-codable-type"},"Swift 4 Codable type"),(0,o.kt)("p",null,"New in Swift 4 in addition of the above main function signature there are two more signatures out of the box taking advantage of the ",(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/swift/codable"},"Codable")," type. You can learn more about data types encodable and decodable for compatibility with external representations such as JSON ",(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types"},"here"),"."),(0,o.kt)("p",null,"The following takes as input parameter a Codable Input with field ",(0,o.kt)("inlineCode",{parentName:"p"},"name"),", and returns a Codable output with a field ",(0,o.kt)("inlineCode",{parentName:"p"},"greetings")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'struct Input: Codable {\n    let name: String?\n}\nstruct Output: Codable {\n    let greeting: String\n}\nfunc main(param: Input, completion: (Output?, Error?) -> Void) -> Void {\n    let result = Output(greeting: "Hello \\(param.name ?? "stranger")!")\n    print("Log greeting:\\(result.greeting)")\n    completion(result, nil)\n}\n')),(0,o.kt)("p",null,"In this example the Swift action consumes a Codable and produces a Codable type.\nIf you don't need to handle any input you can use the function signature that doesn't take any input, only Codable output."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'struct Output: Codable {\n    let greeting: String\n}\nfunc main(completion: (Output?, Error?) -> Void) -> Void {\n    let result = Output(greeting: "Hello OpenWhisk!")\n    completion(result, nil)\n}\n')),(0,o.kt)("p",null,"You can create a OpenWhisk action called ",(0,o.kt)("inlineCode",{parentName:"p"},"helloSwift")," from this function as\nfollows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk action create helloSwift hello.swift\n")),(0,o.kt)("p",null,"See the Swift ",(0,o.kt)("a",{parentName:"p",href:"#reference"},"reference")," for more information about the Swift runtime."),(0,o.kt)("p",null,"Action invocation is the same for Swift actions as it is for JavaScript actions:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wsk action invoke --result helloSwift --param name World\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "greeting": "Hello World!"\n}\n')),(0,o.kt)("p",null,"Find out more about parameters in the ",(0,o.kt)("a",{parentName:"p",href:"/docs/openwhisk-parameters"},"Working with parameters")," section."),(0,o.kt)("h3",{id:"packaging-an-action-as-a-swift-executable"},"Packaging an action as a Swift executable"),(0,o.kt)("p",null,"When you create an OpenWhisk Swift action with a Swift source file, it has to be compiled into a binary before the action is run. Once done, subsequent calls to the action are much faster until the container holding your action is purged. This delay is known as the cold-start delay."),(0,o.kt)("p",null,"To avoid the cold-start delay, you can compile your Swift file into a binary and then upload to OpenWhisk in a zip file. As you need the OpenWhisk scaffolding, the easiest way to create the binary is to build it within the same environment as it will be run in."),(0,o.kt)("h3",{id:"compiling-swift-42-packaged-actions"},"Compiling Swift 4.2 packaged actions"),(0,o.kt)("p",null,"The docker runtime includes a compiler to help users compile and package Swift 4.2 actions."),(0,o.kt)("h4",{id:"compiling-a-single-source-file-for-swift-42"},"Compiling a single source file for Swift 4.2"),(0,o.kt)("p",null,"To compile a single source file that doesn't depend on external libraries you can use the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -i openwhisk/action-swift-v4.2 -compile main <hello.swift >hello.zip\n")),(0,o.kt)("p",null,"The docker container reads from stdin the content of the file, and writes to stdout a zip archive with the compiled swift executable.\nUse the flag ",(0,o.kt)("inlineCode",{parentName:"p"},"-compile")," with the name of the main method.\nThe zip archive is ready for deployment and invocation using the kind ",(0,o.kt)("inlineCode",{parentName:"p"},"swift:4.2")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wsk action update helloSwiftly hello.zip --kind swift:4.2\nwsk action invoke helloSwiftly -r -p name World\n")),(0,o.kt)("h4",{id:"compiling-dependencies-and-multi-file-projects-for-swift-42"},"Compiling dependencies and multi-file projects for Swift 4.2"),(0,o.kt)("p",null,"To compile multiple files and include external dependencies create the following directory structure."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 Package.swift\n\u2514\u2500\u2500 Sources\n    \u2514\u2500\u2500 main.swift\n")),(0,o.kt)("p",null,"The directory ",(0,o.kt)("inlineCode",{parentName:"p"},"Sources/")," should contain a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"main.swift"),".\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"Package.swift")," should start with a comment specifying version ",(0,o.kt)("inlineCode",{parentName:"p"},"4.2")," for the Swift tooling:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'// swift-tools-version:4.2\nimport PackageDescription\n\nlet package = Package(\n    name: "Action",\n    products: [\n    .executable(\n        name: "Action",\n        targets:  ["Action"]\n    )\n    ],\n    dependencies: [\n    .package(url: "https://github.com/IBM-Swift/SwiftyRequest.git", .upToNextMajor(from: "1.0.0"))\n    ],\n    targets: [\n    .target(\n        name: "Action",\n        dependencies: ["SwiftyRequest"],\n        path: "."\n    )\n    ]\n)\n')),(0,o.kt)("p",null,"Create a zip archive with the content of the directory:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"zip ../action-src.zip -r *\n")),(0,o.kt)("p",null,"Pass the zip archive to the docker container over stdin, and the stdout will be a new zip archive with the compiled executable.\nThe docker container reads from stdin the content of the zip archive, and writes to stdout a  new zip archive with the compiled swift executable."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker run -i openwhisk/action-swift-v4.2 -compile main <action-src.zip >../action-bin.zip\n")),(0,o.kt)("p",null,"In a Linux based system you can combined the ",(0,o.kt)("inlineCode",{parentName:"p"},"zip")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"docker run")," steps in a single command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"zip - -r * | docker run -i openwhisk/action-swift-v4.2 -compile main >../action-bin.zip\n")),(0,o.kt)("p",null,"The zip ",(0,o.kt)("inlineCode",{parentName:"p"},"action-bin.zip")," archive is ready for deployment and invocation using the kind ",(0,o.kt)("inlineCode",{parentName:"p"},"swift:4.2")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wsk action update helloSwiftly action-bin.zip --kind swift:4.2\nwsk action invoke helloSwiftly -r\n")),(0,o.kt)("h3",{id:"error-handling-in-swift-4"},"Error Handling in Swift 4"),(0,o.kt)("p",null,"With the new Codable completion handler, you can pass an Error to indicate a failure in your Action.\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/ErrorHandling.html"},"Error handling in Swift")," resembles exception handling in other languages, with the use of the ",(0,o.kt)("inlineCode",{parentName:"p"},"try, catch")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"throw")," keywords.\nThe following example shows a an example on handling an error"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},"enum VendingMachineError: Error {\n    case invalidSelection\n    case insufficientFunds(coinsNeeded: Int)\n    case outOfStock\n}\nfunc main(param: Input, completion: (Output?, Error?) -> Void) -> Void {\n    // Return real error\n    do {\n        throw VendingMachineError.insufficientFunds(coinsNeeded: 5)\n    } catch {\n        completion(nil, error)\n    }\n}\n")),(0,o.kt)("h3",{id:"reference"},"Reference"),(0,o.kt)("h4",{id:"swift-4-1"},"Swift 4"),(0,o.kt)("p",null,"Swift 4 actions are executed using Swift 4.2 using ",(0,o.kt)("inlineCode",{parentName:"p"},"--kind swift:4.2")," respectively.\nThe default ",(0,o.kt)("inlineCode",{parentName:"p"},"--kind swift:default")," is Swift 4.2."),(0,o.kt)("p",null,"Swift 4.x action runtimes don't embed any packages, follow the instructions for ",(0,o.kt)("a",{parentName:"p",href:"/docs/openwhisk-actions#packaging-an-action-as-a-swift-executable"},"packaged swift actions")," to include dependencies using a Package.swift."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Large portions of this page is copied from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/openwhisk/tree/master/docs"},"Apache OpenWhisk documentation")," on April 23rd 2021 - where there have been customisations to match Hypi's deployment this has been noted. Apache OpenWhisk and the Apache name are the property of the Apache Foundation and licensed under the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/openwhisk/blob/master/LICENSE.txt"},"Apache V2 license")," ."))))}u.isMDXComponent=!0}}]);