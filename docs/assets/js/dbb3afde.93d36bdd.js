"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6300],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),s=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),h=r,m=d["".concat(u,".").concat(h)]||d[h]||p[h]||o;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},21332:function(e,t,n){var a=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},8515:function(e,t,n){n.d(t,{Z:function(){return c}});var a=n(87462),r=n(67294),o=n(72389),i=n(35394),l=n(86010),u="tabItem_tAz6";function s(e){var t,n,o,s=e.lazy,c=e.block,p=e.defaultValue,d=e.values,h=e.groupId,m=e.className,v=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=d?d:v.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),g=(0,i.lx)(f,(function(e,t){return e.value===t.value}));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var k=null===p?p:null!=(t=null!=p?p:null==(n=v.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(o=v[0])?void 0:o.props.value;if(null!==k&&!f.some((function(e){return e.value===k})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+k+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var b=(0,i.UB)(),y=b.tabGroupChoices,w=b.setTabGroupChoices,N=(0,r.useState)(k),O=N[0],C=N[1],A=[],T=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var I=y[h];null!=I&&I!==O&&f.some((function(e){return e.value===I}))&&C(I)}var U=function(e){var t=e.currentTarget,n=A.indexOf(t),a=f[n].value;a!==O&&(T(t),C(a),null!=h&&w(h,a))},j=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=A.indexOf(e.currentTarget)+1;n=A[a]||A[0];break;case"ArrowLeft":var r=A.indexOf(e.currentTarget)-1;n=A[r]||A[A.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":c},m)},f.map((function(e){var t=e.value,n=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:O===t?0:-1,"aria-selected":O===t,key:t,ref:function(e){return A.push(e)},onKeyDown:j,onFocus:U,onClick:U},o,{className:(0,l.Z)("tabs__item",u,null==o?void 0:o.className,{"tabs__item--active":O===t})}),null!=n?n:t)}))),s?(0,r.cloneElement)(v.filter((function(e){return e.props.value===O}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==O})}))))}function c(e){var t=(0,o.Z)();return r.createElement(s,(0,a.Z)({key:String(t)},e))}},73674:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return d},default:function(){return m}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=n(8515),l=n(21332),u=["components"],s={id:"oauth2login",title:"OAuth2 Login",sidebar_label:"OAuth2 Login",slug:"/lowcode/oauth2login"},c=void 0,p={unversionedId:"lowcode/oauth2login",id:"lowcode/oauth2login",title:"OAuth2 Login",description:"OAuth2 Authorization framework enables a third-party application to obtain limited access to an external Http service on behalf of the resource owner by orchestrating an interaction between the resource owner and the Http service. On Hypi, application developers can utilize OAuth2 functionality out of the box. Hypi supports a rich set of Http services such as Facebook, Google, Github, Twitter, and more. The following section explains how to integrate OAuth2 functionality in your apps.",source:"@site/content/lowcode/oauth2login.md",sourceDirName:"lowcode",slug:"/lowcode/oauth2login",permalink:"/docs/lowcode/oauth2login",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/lowcode/oauth2login.md",tags:[],version:"current",frontMatter:{id:"oauth2login",title:"OAuth2 Login",sidebar_label:"OAuth2 Login",slug:"/lowcode/oauth2login"},sidebar:"docs",previous:{title:"RESTful APIs",permalink:"/docs/lowcode/rest-apis"},next:{title:"Password Reminder",permalink:"/docs/lowcode/password-reminder"}},d=[{value:"How to setup and use OAuth2 Login?",id:"how-to-setup-and-use-oauth2-login",children:[{value:"Register Developer Account",id:"register-developer-account",children:[],level:3},{value:"Create OAuthProvider Object",id:"create-oauthprovider-object",children:[],level:3},{value:"Enum Parameters",id:"enum-parameters",children:[],level:3},{value:"Provider Endpoints",id:"provider-endpoints",children:[],level:3},{value:"Redirection URIs",id:"redirection-uris",children:[],level:3},{value:"Trigger Authorization Flow",id:"trigger-authorization-flow",children:[],level:3},{value:"Retrieve Access Token",id:"retrieve-access-token",children:[],level:3}],level:2}],h={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,u);return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"OAuth2 Authorization framework enables a third-party application to obtain limited access to an external Http service on behalf of the resource owner by orchestrating an interaction between the resource owner and the Http service. On Hypi, application developers can utilize OAuth2 functionality out of the box. Hypi supports a rich set of Http services such as Facebook, Google, Github, Twitter, and more. The following section explains how to integrate OAuth2 functionality in your apps."),(0,o.kt)("h2",{id:"how-to-setup-and-use-oauth2-login"},"How to setup and use OAuth2 Login?"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#register-developer-account"},"Register Developer Account")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#create-oauthprovider-object"},"Create OAuthProvider Object")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#trigger-authorization-flow"},"Trigger Authorization Flow")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#retrieve-access-token"},"Retrieve Access Token"))),(0,o.kt)("h3",{id:"register-developer-account"},"Register Developer Account"),(0,o.kt)("p",null,"External Http services enable developers to register applications on their platforms and then provide ",(0,o.kt)("inlineCode",{parentName:"p"},"ClientKey")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"ClientSecret")," that can be used at subsequent API requests. "),(0,o.kt)("p",null,"For example, for Google one can register an application on "),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"https://console.developers.google.com/apis/credentials"),"."),(0,o.kt)("h3",{id:"create-oauthprovider-object"},"Create OAuthProvider Object"),(0,o.kt)("p",null,"Once the ",(0,o.kt)("inlineCode",{parentName:"p"},"ClientKey")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"ClientSecret")," have been obtained, then start by using GraphQL to integrate OAuth2 to your application on Hypi. Provide the JSON payload data for the GraphQL request under the ",(0,o.kt)("inlineCode",{parentName:"p"},"Variables")," tab as an input data.."),(0,o.kt)(i.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Input Data",value:"data"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"mutation Upsert($values: HypiUpsertInputUnion!) {\n  upsert(values: $values) {\n    id\n  }\n}\n"))),(0,o.kt)(l.Z,{value:"data",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "values": {\n    "OAuthProvider": {\n      "clientId": "Your Client Key",\n      "clientSecret": "Your Client Secret",\n      "clientAuthenticationMethod": "basic",\n      "authorizationGrantType": "authorization_code",\n      "redirectUriTemplate": "{baseUrl}/login/oauth2/code/{registrationId}",\n      "scopes": [\n        "openid",\n        "profile",\n        "email",\n        "address",\n        "phone",\n        "add more comma separated list of scopes"\n      ],\n      "authorizationUri": "https://accounts.google.com/o/oauth2/v2/auth",\n      "tokenUri": "https://www.googleapis.com/oauth2/v4/token",\n      "userInfoUri": "https://www.googleapis.com/oauth2/v3/userinfo",\n      "userInfoAuthenticationMethod": "header",\n      "userNameAttributeName": "sub",\n      "jwkSetUri": "https://www.googleapis.com/oauth2/v3/certs",\n      "configurationMetadata": [\n        {\n          "key": "foo",\n          "value": "bar"\n        },\n        {\n          "key": "baz",\n          "value": "qux"\n        }\n      ],\n      "clientName": "Google",\n      "hypiSuccessRedirectUri": "https://youcallbackdomain.com/successfulLogin"\n    }\n  }\n}\n')))),(0,o.kt)("h3",{id:"enum-parameters"},"Enum Parameters"),(0,o.kt)("p",null,"The following variables can take any value as long as it is described on the enum type in the core GraphQL schema on Hypi."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"enum UserNameAttributeName {\n  iss\n  sub\n  aud\n  exp\n  iat\n  auth_time\n  nonce\n  acr\n  amr\n  azp\n  at_hash\n  c_hash\n}\nenum AuthenticationMethod {\n  header\n  form\n  query\n}\nenum AuthorizationGrantType {\n  authorization_code\n  implicit\n  refresh_token\n  client_credentials\n}\nenum ClientAuthenticationMethod {\n  basic\n  post\n}\n")),(0,o.kt)("p",null,"The definition of the above parameters can be found in the official standard specification of OAuth2 ",(0,o.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc6749"},"Read more")),(0,o.kt)("h3",{id:"provider-endpoints"},"Provider Endpoints"),(0,o.kt)("p",null,"The following parameters are specific to the external Http service."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'{\n  "authorizationUri": "",\n  "tokenUri": "",\n  "userInfoUri": "",\n  "jwkSetUri": ""\n}\n')),(0,o.kt)("p",null,"For Google, the values would be:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'{\n  "authorizationUri": "https://accounts.google.com/o/oauth2/v2/auth",\n  "tokenUri": "https://www.googleapis.com/oauth2/v4/token",\n  "userInfoUri": "https://www.googleapis.com/oauth2/v3/userinfo",\n  "jwkSetUri": "https://www.googleapis.com/oauth2/v3/certs"\n}\n')),(0,o.kt)("p",null,"For GitHub, the values would be:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"{\n    authorizationUri: https://github.com/login/oauth/authorize\n    tokenUri: https://github.com/login/oauth/access_token\n    userInfoUri: https://api.github.com/user\n}\n")),(0,o.kt)("h3",{id:"redirection-uris"},"Redirection URIs"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"redirectUriTemplate")," variable is reserved for Hypi in order to handle the callback response from the external Http service. It is always set to as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'{\n  "redirectUriTemplate": "{baseUrl}/login/oauth2/code/{registrationId}"\n}\n')),(0,o.kt)("p",null,"Then provide the redirection Uri that the enduser should land on after the OAuth2 flow is complete. The value must represent a valid Http formatted Uri."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'{\n  "hypiSuccessRedirectUri": "https://youcallbackdomain.com/successfulLogin"\n}\n')),(0,o.kt)("p",null,"Hypi will add a query parameter ",(0,o.kt)("inlineCode",{parentName:"p"},"token")," to the redirectUri that can be used to communicate with Hypi Platform representing the resource owner who has completed the authorization process. This token is the same as if you were to call the built in ",(0,o.kt)("inlineCode",{parentName:"p"},"login")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"loginByEmail")," methods in Hypi i.e. it is a JWT token which can be used to call any Hypi API that would otherwise be called with a token returned by one of these methods."),(0,o.kt)("h3",{id:"trigger-authorization-flow"},"Trigger Authorization Flow"),(0,o.kt)("p",null,"In order to start the authorization process, send the user to the following URL"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"https://api.hypi.app/oauth2/authorization/${registrationId}")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"registrationId")," is constructed as",(0,o.kt)("inlineCode",{parentName:"p"},"instanceId"),"-",(0,o.kt)("inlineCode",{parentName:"p"},"OAuthProviderId"),".",(0,o.kt)("inlineCode",{parentName:"p"},"instanceId")," is the Hypi App Instance ID and ",(0,o.kt)("inlineCode",{parentName:"p"},"OAuthProviderId")," is the ID of the ",(0,o.kt)("inlineCode",{parentName:"p"},"OAuthProvider")," which is created in the first step. "),(0,o.kt)("p",null,"For example, "),(0,o.kt)("p",null,"if ",(0,o.kt)("inlineCode",{parentName:"p"},"instanceId")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"NOV5MNZTF01Q8XIUCCA099CXZY")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"OAuthProviderId")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"01ERDGNV0W50J8WZZRVXR4KASC")," then the ",(0,o.kt)("inlineCode",{parentName:"p"},"registrationId")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"NOV5MNZTF01Q8XIUCCA099CXZY-01ERDGNV0W50J8WZZRVXR4KASC")),(0,o.kt)("p",null,"and the URL to initialize the flow is"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"https://api.hypi.app/oauth2/authorization/NOV5MNZTF01Q8XIUCCA099CXZY-01ERDGNV0W50J8WZZRVXR4KASC")),(0,o.kt)("h3",{id:"retrieve-access-token"},"Retrieve Access Token"),(0,o.kt)("p",null,"Hypi stores the ",(0,o.kt)("inlineCode",{parentName:"p"},"accessToken")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"refreshToken")," and they can be found on the GraphQL type ",(0,o.kt)("inlineCode",{parentName:"p"},"OAuth2AuthorizedClient"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"type OAuth2AuthorizedClient {\n  clientRegistrationId: String\n  principalName: String\n  accessToken: String\n  refreshToken: String\n}\n")))}m.isMDXComponent=!0}}]);