"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7081],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,h=c["".concat(s,".").concat(m)]||c[m]||d[m]||o;return n?a.createElement(h,l(l({ref:t},u),{},{components:n})):a.createElement(h,l({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1332:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},8515:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(7462),r=n(7294),o=n(2389),l=n(5394),i=n(6010),s="tabItem_tAz6";function p(e){var t,n,o,p=e.lazy,u=e.block,d=e.defaultValue,c=e.values,m=e.groupId,h=e.className,k=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=c?c:k.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),y=(0,l.lx)(f,(function(e,t){return e.value===t.value}));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===d?d:null!=(t=null!=d?d:null==(n=k.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(o=k[0])?void 0:o.props.value;if(null!==b&&!f.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var g=(0,l.UB)(),v=g.tabGroupChoices,N=g.setTabGroupChoices,w=(0,r.useState)(b),T=w[0],I=w[1],P=[],O=(0,l.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var x=v[m];null!=x&&x!==T&&f.some((function(e){return e.value===x}))&&I(x)}var C=function(e){var t=e.currentTarget,n=P.indexOf(t),a=f[n].value;a!==T&&(O(t),I(a),null!=m&&N(m,a))},E=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=P.indexOf(e.currentTarget)+1;n=P[a]||P[0];break;case"ArrowLeft":var r=P.indexOf(e.currentTarget)-1;n=P[r]||P[P.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":u},h)},f.map((function(e){var t=e.value,n=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,key:t,ref:function(e){return P.push(e)},onKeyDown:E,onFocus:C,onClick:C},o,{className:(0,i.Z)("tabs__item",s,null==o?void 0:o.className,{"tabs__item--active":T===t})}),null!=n?n:t)}))),p?(0,r.cloneElement)(k.filter((function(e){return e.props.value===T}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},k.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==T})}))))}function u(e){var t=(0,o.Z)();return r.createElement(p,(0,a.Z)({key:String(t)},e))}},6633:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return p},contentTitle:function(){return u},metadata:function(){return d},toc:function(){return c},default:function(){return h}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),l=n(8515),i=n(1332),s=["components"],p={id:"webhooks",title:"Webhooks",sidebar_label:"Webhooks",slug:"/lowcode/webhooks"},u=void 0,d={unversionedId:"lowcode/webhooks",id:"lowcode/webhooks",title:"Webhooks",description:"Webhooks provide a way for external APIs to notify you when some event has occurred in their system. That is a typical use case for this API.",source:"@site/content/lowcode/webhook.md",sourceDirName:"lowcode",slug:"/lowcode/webhooks",permalink:"/docs/lowcode/webhooks",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/lowcode/webhook.md",tags:[],version:"current",frontMatter:{id:"webhooks",title:"Webhooks",sidebar_label:"Webhooks",slug:"/lowcode/webhooks"},sidebar:"docs",previous:{title:"Triggers",permalink:"/docs/lowcode/triggers"},next:{title:"File Upload",permalink:"/docs/lowcode/fileupload"}},c=[{value:"Example",id:"example",children:[],level:2}],m={toc:c};function h(e){var t=e.components,n=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Webhooks")," provide a way for external APIs to notify you when some event has occurred in their system. That is a typical use case for this API."),(0,o.kt)("p",null,"These APIs are generally not secure. Different providers have different mechanisms for proving to you that the request is genuinely from them. Hypi provides you access to all the data sent in the request, this enables you to perform verification as you see fit."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"webhook")," can handle events of any type like payment failure, notification for a new post on the blog, reporting of an issue in the system, etc. And the response to the event could be an automated email or storing the data in the database. The response can be customized based upon the status code sent through the ",(0,o.kt)("inlineCode",{parentName:"p"},"HTTP request"),"."),(0,o.kt)("p",null,"Let's say a payment system wants to notify the failure of Payments. So, the payment system sends an automated message or ",(0,o.kt)("inlineCode",{parentName:"p"},"payload")," to the App Instance through an HTTP POST. A function defined in the App Schema process the webhook request. It parses the payload and extracts the data from it. The payload type is usually JSON. But some providers may send XML or URL encoded form data."),(0,o.kt)("p",null,"If the data of the payload has an ",(0,o.kt)("inlineCode",{parentName:"p"},"email ID")," of the customer whose payment failed, a ",(0,o.kt)("a",{parentName:"p",href:"/docs/lowcode/triggers"},"trigger")," can be invoked to send an email to him automatically."),(0,o.kt)("p",null,"Let\u2019s define a function ",(0,o.kt)("inlineCode",{parentName:"p"},"myInlineFn")," in the schema that processes a ",(0,o.kt)("inlineCode",{parentName:"p"},"webhook")," request. "),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For the webhook to correct properly, the signature of the function processing webhook request must be ",(0,o.kt)("inlineCode",{parentName:"p"},"(payload: WebhookPayload): WebhookResponse")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'type Query {\n  myInlineFn(payload: WebhookPayload): \n    WebhookResponse @tan(type:Groovy, inline: """\n    return [\n      "status": 200,\n      "headers": payload.headers,\n      "body": payload.url.host + ":" + \n              payload.url.port + payload.url.path + "?" \n              + payload.url.queryParams + "<>" + payload.body\n    ]\n  """)\n}\n')),(0,o.kt)("p",null,"Let's go through the data types related to Webhook."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"type WebhookPayload\xa0{\n    url:\xa0URLInput!\n    headers:\xa0Json!\n    body:\xa0String\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Webhookpayload")," data type stores the data of a payload. A payload has url string along with a header and body."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"url")),(0,o.kt)("td",{parentName:"tr",align:null},"URLInput"),(0,o.kt)("td",{parentName:"tr",align:null},"Input URL provided by the payload")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"headers")),(0,o.kt)("td",{parentName:"tr",align:null},"JSON"),(0,o.kt)("td",{parentName:"tr",align:null},"Header of the Payload HTTP request/response")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"body")),(0,o.kt)("td",{parentName:"tr",align:null},"String"),(0,o.kt)("td",{parentName:"tr",align:null},"Data Attached to Payload")))),(0,o.kt)("p",null,"Input url contains url information like ",(0,o.kt)("inlineCode",{parentName:"p"},"url path"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"query parameters"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"port"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"host"),", etc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"type WebhookResponse\xa0{\n    status:\xa0Int\n    headers:\xa0Json\n    body:\xa0Json\n}\n")),(0,o.kt)("p",null,"If the query or mutation functions in the Webhook definition (myInlineFn) returns this then it controls what the server responds with. For example, the GraphQL function can return a 301 or 302 ",(0,o.kt)("inlineCode",{parentName:"p"},"status")," and a Location header to an external URL to cause a redirect. If ",(0,o.kt)("inlineCode",{parentName:"p"},"status")," 200 gets returned, it indicates the success of the event. You may extract the ",(0,o.kt)("inlineCode",{parentName:"p"},"status")," by parsing the input HTTP POST request."),(0,o.kt)("p",null,"You can design the ",(0,o.kt)("inlineCode",{parentName:"p"},"myInlineFn")," as per the requirements. It takes the shape of  ",(0,o.kt)("a",{parentName:"p",href:"/docs/lowcode/user-defined-function"},"User Defined Function"),". But as stated above, its signature remains the same. In the current function defined in the schema, it returns HTTP request status as 200 and it separates the payload header and body. The URL input parameters of the payload get attached to the payload body forming a response string."),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"type Webhook\xa0{\n    name:\xa0String\n    as:\xa0Account\n    query:\xa0GraphQLRef!\n}\n")),(0,o.kt)("p",null,"Webhook type is defined in Hypi as above. A webhook object needs to be created in an instance to send/receive a webhook HTTP request/response through an endpoint. The parameters of the Webhook type are as follows."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"name")),(0,o.kt)("td",{parentName:"tr",align:null},"String"),(0,o.kt)("td",{parentName:"tr",align:null},"The name of the webhook. It is referenced in the URL by this name. If missing the webhook is only addressable by ID")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"as")),(0,o.kt)("td",{parentName:"tr",align:null},"Account"),(0,o.kt)("td",{parentName:"tr",align:null},"Defaults to the account creating the Webhook. Hypi will generate an authorization token automatically for the account when the webhook is triggered.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"query")),(0,o.kt)("td",{parentName:"tr",align:null},"GraphQLRef"),(0,o.kt)("td",{parentName:"tr",align:null},"This refers to a GraphQL function to process webhook requests. The function can trigger a workflow or operate on the payload itself.")))),(0,o.kt)("p",null,"Let\u2019s check GraphQLRef\xa0type as well"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"type GraphQLRef\xa0{\n    type:\xa0OpType!\n    field:\xa0String!\n    selection:\xa0String\n}\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"type")),(0,o.kt)("td",{parentName:"tr",align:null},"OpType"),(0,o.kt)("td",{parentName:"tr",align:null},"Query/Mutation/Subscription")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"field")),(0,o.kt)("td",{parentName:"tr",align:null},"String"),(0,o.kt)("td",{parentName:"tr",align:null},"The name of the function that processes the webhook request.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"selection")),(0,o.kt)("td",{parentName:"tr",align:null},"String"),(0,o.kt)("td",{parentName:"tr",align:null},"If present this is a set of GraphQL fields that will be selected from the results of the function that is referenced.")))),(0,o.kt)("p",null,"A simple webhook example looks like this."),(0,o.kt)(l.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Input Data",value:"data"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"mutation Upsert($values: HypiUpsertInputUnion!) {\n  upsert(values: $values) {\n    id\n  }\n}\n"))),(0,o.kt)(i.Z,{value:"data",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'{\n  "values": {\n    "Webhook": [\n             {\n              "hypi": {\n              "id": "wid"\n              },\n             "name": "wh1",\n            "query": {\n            "type": "Query",\n            "field": "myInlineFn"\n            }\n          }\n       ]\n    }\n}\n')))),(0,o.kt)("p",null,"Once a Webhook is created, it can be called by making an HTTP request to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#"},"https://api.hypi.app/webhook/{domain}/{webhookname}"))),(0,o.kt)("p",null,"where ",(0,o.kt)("inlineCode",{parentName:"p"},"{domain}")," is the instance domain for your app and ",(0,o.kt)("inlineCode",{parentName:"p"},"{webhook name}")," is the name of the webhook to be executed. In the example on this page, the name is ",(0,o.kt)("inlineCode",{parentName:"p"},"wh1"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Ex:"),"  ",(0,o.kt)("a",{parentName:"p",href:"#"},"https://api.hypi.app/webhook/incineration.apps.hypi.app/wh1")))}h.isMDXComponent=!0}}]);